# 需求文件

## 簡介

本專案旨在開發一個「最小可用」的服務管理後端系統，提供會員註冊/登入功能以及服務（Service）的完整 CRUD 操作。系統採用 TypeScript + Node.js + Koa + SQLite 技術棧，並使用 JWT 進行身份驗證。

## 需求

### 需求 1：會員註冊功能

**使用者故事：** 作為一個新使用者，我想要註冊帳號，以便能夠管理服務項目。

#### 驗收標準

1. 當使用者提供有效的 email、密碼和姓名時，系統應該建立新的會員帳號
2. 當使用者提供的 email 已存在時，系統應該回傳錯誤訊息
3. 當密碼儲存時，系統應該進行雜湊處理以確保安全性
4. 當註冊成功時，系統應該回傳成功訊息和使用者基本資訊（不含密碼）

### 需求 2：會員登入功能

**使用者故事：** 作為一個已註冊的使用者，我想要登入系統，以便能夠存取需要權限的功能。

#### 驗收標準

1. 當使用者提供正確的 email 和密碼時，系統應該驗證身份並回傳 JWT token
2. 當使用者提供錯誤的 email 或密碼時，系統應該回傳驗證失敗的錯誤訊息
3. 當登入成功時，系統應該回傳包含 JWT token 的回應
4. JWT token 應該包含使用者識別資訊且具有適當的過期時間

### 需求 3：服務項目查詢功能（公開）

**使用者故事：** 作為任何使用者（包含未登入），我想要查看可用的服務項目，以便了解提供的服務內容。

#### 驗收標準

1. 當請求服務列表時，系統應該回傳所有公開且未刪除的服務項目
2. 當請求單一服務詳情時，系統應該回傳該服務的完整資訊
3. 當請求不存在的服務時，系統應該回傳適當的錯誤訊息
4. 服務列表應該按照 order 欄位進行排序

### 需求 4：服務項目管理功能（需要權限）

**使用者故事：** 作為已登入的管理者，我想要新增、修改和刪除服務項目，以便管理系統提供的服務。

#### 驗收標準

1. 當已驗證使用者新增服務時，系統應該建立新的服務項目並回傳服務資訊
2. 當已驗證使用者更新服務時，系統應該修改指定服務的資訊
3. 當已驗證使用者刪除服務時，系統應該進行軟刪除（設定 isRemove 為 true）
4. 當未驗證使用者嘗試執行管理操作時，系統應該回傳權限不足的錯誤訊息
5. 所有管理操作都應該驗證 JWT token 的有效性

### 需求 5：資料驗證與安全性

**使用者故事：** 作為系統管理者，我想要確保所有輸入資料都經過適當驗證，以便維護系統的資料完整性和安全性。

#### 驗收標準

1. 當接收到 API 請求時，系統應該使用 Joi 驗證所有輸入參數
2. 當輸入資料格式不正確時，系統應該回傳詳細的驗證錯誤訊息
3. 當存取需要權限的 API 時，系統應該驗證 JWT token 的有效性
4. 所有密碼都應該經過雜湊處理後才儲存到資料庫

### 需求 6：資料庫結構與資料管理

**使用者故事：** 作為開發者，我想要有清楚的資料庫結構和資料管理機制，以便確保資料的一致性和可維護性。

#### 驗收標準

1. 系統應該包含 Users 表格，包含 id、email、password、name、createdAt、updatedAt 欄位
2. 系統應該包含 AppointmentServices 表格，包含 id、name、description、price、showTime、order、isRemove、isPublic、createdAt、updatedAt 欄位
3. 當系統啟動時，應該自動執行資料庫 migration 建立必要的表格和索引
4. 系統應該支援 seed 資料的載入以便測試和開發